---
title: "Project 1"
author: "Brian Sugg"
date: "6/12/2020"
output:
  rmarkdown::github_document:
    toc: true
    toc_depth: 3
  html_document:
    toc: true
    toc_depth: 3
---

```{r setupOptions, include=FALSE}
library(tidyverse)
library(Lahman)
library(formatR)
library(dplyr)
library(httr)
library(jsonlite)
knitr::opts_chunk$set(message=FALSE,tidy.opts=list(width.cutoff=70),tidy=TRUE)
```

# Introduction to JSON Data  

## Background  

JSON stands for JavaScript Object Notation and is simply a method for writing out data objects using the JavaScript language for quick and efficient transmission between servers and browsers. JavaScript is a lightweight programming language with less syntax notation that makes it easy to read, write, and store data. The lightweight structure of JSON makes it a great way to quickly and efficiently send large amounts of data with minimal wait time and storage size.  

JSON is commonly used when creating and consuming data via API connections. It can ingest text strings, numbers, boolean values, `null` values, arrays, and objects into long strings of text that get delivered to a client for processing. An example from the [Mozilla Developers](https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/JSON) webpage helps illustrate how data describing a superhero, "Molecule Man", would look in JavaScript format within a JSON file:  

`{"name":"Molecule Man","age": 29,"secretIdentity":"Dan Jukes","powers":["Radiation resistance","Turning tiny","Radiation blast"]}`

This file can be received and unpackaged by a browser for parsing back into a consumable format, such as:

```{r molecule.png, out.width="30%"}
knitr::include_graphics("images/moleculeMan.PNG")
```

More information on JSON including its history and usage can be found in the [Wikipedia](https://en.wikipedia.org/wiki/JSON) community. The following sections will look further into how JSON files can be unpackaged and parsed into R, including an example connection to an API for the National Hockey League (NHL).  

## Reading JSON DATA into R  

Discuss the possible packages/functions that are available for reading JSON data into R.  
rjson & rjsonio
jsonlite & httr
tidyjson & dplyr
Pick 3.

### Package 1  

Details on available package 1 (to be named).  

### Package 2  

Details on available package 2 (to be named).  

### Package 3  

Details on available package 1 (to be named).  

## Package for this Vignette  

Name which package will be used in the upcoming API call to NHL records, and why.  

# NHL Franchise API  

## Background  

The professional hockey leaague across the United States and Canada is the  National Hockey League (NHL), which provides an API for public consumption. The NHL offers almost no official documentation for this connection and its available endpoints. To help navigate this API, open source documentation from this [GitLab](https://gitlab.com/dword4/nhlapi/-/blob/master/records-api.md) will be used to understand what data is available, relevant URL addresses, and how to filter on certain attributes in the API query.  

The following sections will focus primarily on retrieving data for NHL franchises, players (goalies and skaters), and season stats. Some numerical summaries will be presented, along with the exploration of analytical summaries containing visuals of various plots.  

## Establishing API Connection  

The base URL for the NHL API is `https://records.nhl.com/site/api` which can be called with different extensions such as `/franchise` to retrieve data from a specific endpoint, or additionally with a Franchise ID such as `26` (Carolina Hurricanes) to return data filtered on specific franchises.  

Two functions below have been created for calling the NHL API:  

* `nhlTable(tableName)` calls the provided endpoint from the user, parses, and returns a tibble of that endpoint.  
* `nhlTableWithFranchiseId(tableName,franId)` calls the provided endpoint and the desired Franchise ID from the user, parses, and returns a tibble of that endpoint filtered on the respective franchise.  

These functions will be used to call the following endpoints, creating tibbles for each:  

* `/franchise` to create table `fran`  
* `/franchise-team-totals` to create table `franTot`  
* `/franchise-season-records` to create table `franSeason`  
    + Filtered on Franchise ID `26` for the Carolina Hurricanes  
* `/franchise-goalie-records` to create table `franGoal`  
    + Filtered on Franchise ID `26` for the Carolina Hurricanes  
* `/franchise-skater-records` to create table `franSkate`  
    + Filtered on Franchise ID `26` for the Carolina Hurricanes  

These tables will be used in the upcoming section on "Exploratory Data Analysis".  

```{r nhlApiFunctions}
nhlTable <- function(tableName){
  baseURL <- "https://records.nhl.com/site/api"
  # GET() used to retrieve information in raw form, content() transforms raw into JSON text for conversion with fromJSON().  
  queryGET <- GET(paste0(baseURL,tableName))
  queryText <- content(queryGET, "text")
  queryJSON <- fromJSON(queryText, flatten = TRUE)
  # Reformat data from the returned list into a usable structure, a tibble.  
  queryList <- as.list(queryJSON) 
  queryTbl <- as_tibble(queryList[[1]])
}
nhlTableWithFranchiseId <- function(tableName,FranId){
  baseURL <- "https://records.nhl.com/site/api"
  # GET() used to retrieve information in raw form, content() transforms raw into JSON text for conversion with fromJSON().  
  queryGET <- GET(paste0(baseURL,tableName,"?cayenneExp=franchiseId=",FranId))
  queryText <- content(queryGET, "text")
  queryJSON <- fromJSON(queryText, flatten = TRUE)
  # Reformat data from the returned list into a usable structure, a tibble.  
  queryList <- as.list(queryJSON) 
  queryTbl <- as_tibble(queryList[[1]])
}
# Function calls for 5 different endpoints, with 3 calling franchiseId=26 for the Carolina Hurricanes:
fran <- nhlTable("/franchise")
fran
franTot <- nhlTable("/franchise-team-totals")
franTot
franSeason <- nhlTableWithFranchiseId("/franchise-season-records",26)
franSeason
franGoal <- nhlTableWithFranchiseId("/franchise-goalie-records",26)
franGoal
franSkate <- nhlTableWithFranchiseId("/franchise-skater-records",26)
franSkate
```

## Exploratory Data Analysis  

### The Data  

Check for any needed formatting, create a new variable as required (think teamName from franchise table).  

### Numeric Summaries  

Provide contingecy tables and numeric summaries as required.  

### Visuals  

Create some plots (bar, box, scatter) with discussion of observations for each.  
